= Redis
:toc:

== client

[source, bash]
----
$ brew install redis
$ redis-cli -h $host -p $port
> config get *
----

* ~https://github.com/luin/medis~
* https://github.com/qishibo/AnotherRedisDesktopManager

== 자료구조

=== String

[source]
----
> set hello world
OK
> get hello
"world"
> exists hello
(integer) 1
> del hello
(integer) 1
> exists hello
(integer) 0
----

[source]
----
> set counter 100
OK
> get counter
"100"
> incr counter
(integer) 101
> incr counter
(integer) 102
> incrby counter 50
(integer) 152
----

[source]
----
> incr count
1
> getset count 0
"1"
> get count
"0"
> del count
(integer) 1
> get count
(nil)
----

=== List

* linked list
* pub-sub 패턴으로 활용

[source, bash]
----

----

=== Hash

[source, bash]
----
> hmget user2 email country
1) "id@domain.com"
2) "Korea"
----

=== Set

[source]
----
> sadd partner:visa:merchants 3212 1231 <1>
(integer) 2
> smembers partner:visa:merchants <2>
1) "3212"
2) "1231"
> scard partner:visa:merchants <3>
(integer) 2
> sismember partner:visa:merchants 3212 <4>
(integer) 1
> srandmember partner:visa:merchants <5>
"1231"
> srandmember partner:visa:merchants 2 <6>
1) "1231"
2) "3212"
> srandmember partner:visa:merchants -2 <7>
1) "1231"
2) "1231"
> spop
> stem
> smove
> sinter
> sinterstore
> sdiff
> sdiffstore
> sunion
> sunionstore
----
<1> _set add_
<2> set members
<3> set cardinality
<4> if is member, return 1(`true`). otherwise, return 0(`false`)
<5> set random member
<6> multiple random
<7> multiple random(duplicate)

=== Sorted Set

== key naming

* https://keichee.tistory.com/248
* https://stackoverflow.com/questions/6965451/redis-key-naming-conventions
* https://stackoverflow.com/questions/30271808/naming-convention-and-valid-characters-for-a-redis-key/30271837
* max size: 512 MB

[source]
----
object-type#id:data
partner:user#123:name
partner:merchant#123:bno
partner:merchant#123
merchant#121231:base-url
users // <1>
----
<1> `users`에 user 키를 모두 저장하는 list 혹은 set 


== batch

bulk insert `cat data.txt | redis-cli --pipe` using pipe mode

== transaction

[source]
----
MULTI
INCR id:users
SET user:{id} '{"name": "yj","age": 30}'
SADD users {id}
EXEC
----

* https://redis.io/topics/transactions
* https://dark0096.github.io/redis/2018/10/27/redis-transaction.html
